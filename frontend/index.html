<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fatura Yönetimi • Gelişmiş Arayüz</title>
  <style>
    :root{
      --bg:#0f1115;--card:#171923;--muted:#232737;--text:#e7e9ee;--text-dim:#aab0c0;--brand:#7c5cff;--brand-2:#4fd1c5;--danger:#ff5c7c;--warning:#ffc861;--ok:#5cff92;
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:14px/1.5 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#0c0e13, #0f1115 35%);color:var(--text)}
    .container{max-width:1200px;margin:32px auto;padding:0 16px}
    .grid{display:grid;gap:16px}
    .grid.cols{grid-template-columns: 1.5fr 1fr}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.0));border:1px solid rgba(255,255,255,0.06);border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,0.35);}
    .card > .hd{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,0.06)}
    .card > .bd{padding:16px}
    .title{font-size:18px;font-weight:700;letter-spacing:0.2px}
    .muted{color:var(--text-dim)}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    button{appearance:none;border:0;border-radius:12px;padding:10px 12px;background:var(--muted);color:var(--text);cursor:pointer;transition:transform .04s ease, filter .15s ease;}
    button:hover{filter:brightness(1.08)}
    button:active{transform:translateY(1px)}
    .btn-primary{background:linear-gradient(180deg,var(--brand),#5e3bff)}
    .btn-soft{background:linear-gradient(180deg,rgba(255,255,255,0.06),rgba(255,255,255,0.02));}
    .btn-danger{background:linear-gradient(180deg,#ff5c7c,#d63a5a)}
    .btn-ghost{background:transparent;border:1px dashed rgba(255,255,255,.15)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .field{display:flex;flex-direction:column;gap:6px;min-width:120px;flex:1}
    .field label{font-size:12px;color:var(--text-dim)}
    input[type="text"], input[type="number"], input[type="date"], select, textarea{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#0b0d12;color:var(--text)
    }
    table{width:100%;border-collapse:collapse;background:#0b0d12;border-radius:12px;overflow:hidden}
    thead th{background:#0e121a;color:var(--text-dim);text-align:left;font-weight:600;font-size:12px;padding:10px;border-bottom:1px solid rgba(255,255,255,.06);}
    tbody td{padding:10px;border-bottom:1px solid rgba(255,255,255,.06)}
    .tag{padding:4px 8px;border-radius:999px;font-size:12px}
    .tag.draft{background:rgba(124,92,255,.15);color:#cbb9ff}
    .tag.sent{background:rgba(79,209,197,.15);color:#aef3ec}
    .tag.paid{background:rgba(92,255,146,.15);color:#cfffdb}
    .tag.taslak{background:rgba(124,92,255,.15);color:#cbb9ff}
    .tag.onay{background:rgba(79,209,197,.15);color:#aef3ec}
    .empty{padding:18px;text-align:center;color:var(--text-dim)}
    .lines{display:grid;gap:10px}
    /* Açıklama | Birim Fiyat | Adet | KDV | Sil */
    .line{display:grid;grid-template-columns:2fr 1fr .8fr .8fr auto;gap:10px;align-items:center}
    .line .remove{background:transparent;border:1px solid rgba(255,255,255,.12)}
    .foot{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .total{font-weight:700}
    .toast{position:fixed;right:16px;bottom:16px;display:flex;flex-direction:column;gap:8px;z-index:1000}
    .toast .msg{background:#10131a;border:1px solid rgba(255,255,255,.1);border-left:4px solid var(--brand);padding:10px 12px;border-radius:12px;box-shadow:0 10px 22px rgba(0,0,0,.35)}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px}
    .modal.open{display:flex}
    .modal .content{background:var(--card);border:1px solid rgba(255,255,255,.06);padding:18px;border-radius:16px;max-width:720px;width:100%}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size:12px;color:var(--text-dim);background:#0b0d12;border:1px solid rgba(255,255,255,.1);border-radius:6px;padding:2px 6px}
    .chips{display:flex;gap:6px;flex-wrap:wrap}
    .chip{border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:999px;cursor:pointer}
    .chip.active{background:rgba(124,92,255,.15);border-color:rgba(124,92,255,.4)}
    .right{display:flex;gap:8px;align-items:center}
    .hint{font-size:12px;color:var(--text-dim)}
  </style>
</head>
<body>
  <div class="container grid">
    <header class="grid card" style="padding:16px;">
      <div class="row" style="justify-content:space-between;align-items:center;gap:12px;">
        <div>
          <div class="title">Fatura Yönetimi</div>
          <div class="muted">Flask API ile tam uyumlu gelişmiş arayüz • <span class="kbd">GET/POST/PUT/DELETE</span></div>
        </div>
        <div class="toolbar">
          <button id="refreshBtn" type="button" class="btn-soft">Yenile</button>
          <button id="exportBtn" type="button" class="btn-soft">CSV Dışa Aktar</button>
          <button id="newBtn" type="button" class="btn-primary">Yeni Fatura</button>
          <button id="settingsBtn" type="button" class="btn-soft">Ayarlar</button>
          <button id="itemsBtn" type="button" class="btn-soft">Ürün / Stoklar</button>
        </div>
      </div>
      <div class="row" style="margin-top:8px">
        <div class="field" style="max-width:220px">
          <label>Arama</label>
          <input id="q" type="text" placeholder="ID, müşteri, durum..." />
        </div>
        <div class="field" style="max-width:200px">
          <label>Durum Filtresi</label>
          <select id="statusFilter">
            <option value="">Hepsi</option>
            <option value="draft">Draft</option>
            <option value="sent">Sent</option>
            <option value="paid">Paid</option>
            <option value="taslak">Taslak</option>
            <option value="onaylandı">Onaylandı</option>
          </select>
        </div>
        <div class="right">
          <span class="hint">API: <span class="kbd" id="apiLabel">http://127.0.0.1:5000</span></span>
        </div>
      </div>
    </header>

    <main class="grid cols">
      <section class="card">
        <div class="hd">
          <div class="title">Faturalar</div>
          <div class="chips" id="quickChips"></div>
        </div>
        <div class="bd">
          <div style="overflow:auto;border-radius:12px">
            <table>
              <thead>
                <tr>
                  <th style="width:70px">ID</th>
                  <th style="width:120px">Müşteri</th>
                  <th>Tarih</th>
                  <th>Vade</th>
                  <th>Durum</th>
                  <th style="width:120px">Tutar (≈)</th>
                  <th style="width:260px">İşlemler</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>
          <div id="empty" class="empty" style="display:none">Kayıt yok</div>
        </div>
      </section>

      <aside class="card" id="formCard">
        <div class="hd">
          <div class="title" id="formTitle">Yeni Fatura</div>
          <div class="toolbar">
            <button class="btn-ghost" id="clearBtn" type="button">Temizle</button>
          </div>
        </div>
        <div class="bd">
          <form id="form" class="grid" autocomplete="off">
            <input type="hidden" id="invoice_id" />
            <div class="row">
              <div class="field"><label>Müşteri ID</label><input id="contact_id" type="number" placeholder="örn. 1001" required min="0"/></div>
              <div class="field"><label>Tarih</label><input id="issue_date" type="date" required /></div>
              <div class="field"><label>Vade</label><input id="due_date" type="date" required /></div>
            </div>
            <div class="row">
              <div class="field">
                <label>Durum</label>
                <select id="status" required>
                  <option value="draft">draft</option>
                  <option value="sent">sent</option>
                  <option value="paid">paid</option>
                  <option value="taslak">taslak</option>
                  <option value="onaylandı">onaylandı</option>
                </select>
              </div>
              <div class="field">
                <label>Açıklama (not)</label>
                <input id="note" type="text" placeholder="opsiyonel" />
              </div>
            </div>

            <div class="row" style="justify-content:space-between;align-items:center">
              <div class="title" style="font-size:15px">Kalemler</div>
              <button type="button" id="addLineBtn" class="btn-soft">+ Kalem Ekle</button>
            </div>
            <div class="lines" id="lines"></div>
            <div class="foot">
              <div class="muted">KDV oranı boş ise 0 kabul edilir</div>
              <div class="total">
                Ara Toplam: <span id="subtotal">0</span> ₺ • 
                KDV: <span id="taxsum">0</span> ₺ • 
                Genel Toplam: <span id="grand">0</span> ₺
              </div>
            </div>

            <div class="row" style="margin-top:8px">
              <button type="submit" class="btn-primary" id="submitBtn">Kaydet</button>
              <button type="button" class="btn-soft" id="resetBtn">Formu Sıfırla</button>
            </div>
          </form>
        </div>
      </aside>
    </main>
  </div>

  <div class="toast" id="toast"></div>

  <!-- Sil onay -->
  <div class="modal" id="confirmModal">
    <div class="content">
      <div class="title">Emin misin?</div>
      <p class="muted" id="confirmText">Bu kaydı silmek üzeresin.</p>
      <div class="row" style="margin-top:10px;justify-content:flex-end">
        <button class="btn-soft" id="cancelConfirm" type="button">Vazgeç</button>
        <button class="btn-danger" id="okConfirm" type="button">Sil</button>
      </div>
    </div>
  </div>

  <!-- Detay modal -->
  <div class="modal" id="detailModal">
    <div class="content">
      <div class="title">Fatura Detayı</div>
      <div id="detailBody" class="muted" style="margin-top:8px"></div>
      <div class="row" style="margin-top:12px;justify-content:flex-end">
        <button class="btn-soft" type="button" onclick="closeDetail()">Kapat</button>
      </div>
    </div>
  </div>

  <!-- Ayarlar modal -->
  <div class="modal" id="settingsModal">
    <div class="content">
      <div class="title">Ayarlar</div>
      <div class="field" style="margin-top:8px">
        <label>API Adresi</label>
        <input id="apiInput" type="text" placeholder="http://127.0.0.1:5000" />
        <div class="hint">Değişiklik kalıcıdır (localStorage).</div>
      </div>
      <div class="row" style="margin-top:12px;justify-content:flex-end">
        <button class="btn-soft" type="button" onclick="closeSettings()">Vazgeç</button>
        <button class="btn-primary" type="button" onclick="saveSettings()">Kaydet</button>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = localStorage.getItem('apiBase') || 'http://127.0.0.1:5000';
    document.getElementById('apiLabel').textContent = API_BASE;

    // State
    let state = { data: [], filtered: [], query: '', status: '', lines: [], pendingDelete: null };

    // Helpers
    const fmt = n => (isNaN(n)?'-': new Intl.NumberFormat('tr-TR',{maximumFractionDigits:2}).format(n));
    const el = id => document.getElementById(id);

    function toast(msg){
      const t = document.createElement('div'); t.className = 'msg'; t.textContent = msg; el('toast').appendChild(t);
      setTimeout(()=> t.remove(), 2600);
    }

    function tag(status){
      const s = (status||'').toLowerCase();
      const cls = s.includes('taslak')? 'taslak': s.includes('onay')? 'onay': s;
      return `<span class="tag ${cls}">${status||'-'}</span>`;
    }

    function approxTotal(inv){
      try{
        const lines = typeof inv.lines === 'string' ? JSON.parse(inv.lines) : (inv.lines || []);
        return lines.reduce((a,l)=> a + (Number(l.quantity)||0) * (Number(l.unit_price)||0) * (1 + (Number(l.tax_rate)||0)/100), 0);
      }catch{ return 0 }
    }

    // API
    async function api(path, options={}){
      const res = await fetch(`${API_BASE}${path}`, { headers: { 'Content-Type':'application/json' }, ...options });
      if(!res.ok){ throw new Error(`${res.status} ${res.statusText}`) }
      return res.json();
    }

    async function load(){
      try{
        const json = await api('/invoices');
        const list = json.invoices || [];
        state.data = list;
        filter();
      }catch(e){ toast('Yüklenemedi: '+ e.message) }
    }

    function filter(){
      const q = (state.query||'').toLowerCase();
      const st = (state.status||'').toLowerCase();
      state.filtered = state.data.filter(x => {
        const m = `${x.invoice_id} ${x.contact_id} ${x.status} ${x.issue_date} ${x.due_date}`.toLowerCase();
        const okQ = !q || m.includes(q);
        const okS = !st || (x.status||'').toLowerCase().includes(st);
        return okQ && okS;
      }).sort((a,b)=> Number(b.invoice_id) - Number(a.invoice_id));
      renderTable();
    }

    function renderTable(){
      const tbody = el('tbody'); tbody.innerHTML='';
      if(!state.filtered.length){ el('empty').style.display='block'; return } else { el('empty').style.display='none' }
      for(const inv of state.filtered){
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${inv.invoice_id}</td>
          <td>${inv.contact_id ?? '-'}</td>
          <td>${inv.issue_date ?? '-'}</td>
          <td>${inv.due_date ?? '-'}</td>
          <td>${tag(inv.status)}</td>
          <td>${fmt(approxTotal(inv))}</td>
          <td>
            <div class="row" style="gap:6px;justify-content:flex-start">
              <button class="btn-soft" type="button" onclick='viewDetail(${inv.invoice_id})'>👁️ Detay</button>
              <button class="btn-soft" type="button" onclick='edit(${inv.invoice_id})'>✏️ Düzenle</button>
              <button class="btn-danger" type="button" onclick='askDelete(${inv.invoice_id})'>🗑️ Sil</button>
              <button class="btn-soft" type="button" onclick='pdf(${inv.invoice_id})'>📄 PDF</button>
            </div>
          </td>`;
        tbody.appendChild(tr);
      }
    }

    // Form & Lines
    function newLine(data={description:'', quantity:1, unit_price:0, tax_rate:0}){
      const idx = state.lines.length;
      state.lines.push({...data});
      const wrap = document.createElement('div'); 
      wrap.className='line'; 
      wrap.dataset.idx=idx;
      wrap.innerHTML = `
        <div class="field">
          <label>Açıklama</label>
          <input type="text" placeholder="Ürün açıklaması" value="${data.description||''}" 
                 oninput="onLineChange(${idx},'description',this.value)" />
        </div>
        <div class="field">
          <label>Birim Fiyat</label>
          <input type="number" placeholder="0" min="0" value="${data.unit_price||0}" 
                 oninput="onLineChange(${idx},'unit_price',this.value)" />
        </div>
        <div class="field">
          <label>Adet</label>
          <input type="number" placeholder="0" min="0" value="${data.quantity||1}" 
                 oninput="onLineChange(${idx},'quantity',this.value)" />
        </div>
        <div class="field">
          <label>KDV %</label>
          <input type="number" placeholder="0" min="0" value="${data.tax_rate||0}" 
                 oninput="onLineChange(${idx},'tax_rate',this.value)" />
        </div>
        <button type="button" class="remove" onclick="removeLine(${idx}, this)">Sil</button>`;
      el('lines').appendChild(wrap);
      computeTotals();
    }

    window.onLineChange = (i, key, val)=>{ state.lines[i][key] = key==='description'? val : Number(val); computeTotals(); }
    window.removeLine = (i, btn)=>{ state.lines[i]._removed = true; btn.closest('.line').remove(); computeTotals(); }

    function computeTotals(){
      const lines = state.lines.filter(l=>!l._removed);
      let subtotal = 0, taxsum = 0;
      for(const l of lines){
        const q = Number(l.quantity)||0;
        const p = Number(l.unit_price)||0;
        const t = Number(l.tax_rate)||0;
        const lineNet = q * p;
        const lineTax = lineNet * (t/100);
        subtotal += lineNet; taxsum += lineTax;
      }
      const grand = subtotal + taxsum;
      el('subtotal').textContent = fmt(subtotal);
      el('taxsum').textContent   = fmt(taxsum);
      el('grand').textContent    = fmt(grand);
    }

    function clearForm(){
      el('form').reset(); el('invoice_id').value=''; state.lines=[]; el('lines').innerHTML=''; computeTotals(); el('formTitle').textContent='Yeni Fatura';
    }

    async function submitForm(e){
      e.preventDefault();
      const lines = state.lines.filter(l=>!l._removed);
      if(!lines.length){ toast('En az 1 kalem ekle'); return }
      const body = {
        contact_id: Number(el('contact_id').value),
        issue_date: el('issue_date').value,
        due_date: el('due_date').value,
        status: el('status').value,
        note: el('note').value || '',
        lines: lines.map(({description,quantity,unit_price,tax_rate})=>({description,quantity,unit_price,tax_rate}))
      };
      const id = el('invoice_id').value;
      const btn = el('submitBtn'); const prev = btn.textContent; btn.textContent = 'Kaydediliyor…'; btn.disabled = true;
      try{
        if(id){
          await api(`/invoices/${id}`, { method:'PUT', body: JSON.stringify(body) });
          toast(`Fatura #${id} güncellendi`);
        }else{
          const r = await api('/invoices', { method:'POST', body: JSON.stringify(body) });
          toast(`Fatura oluşturuldu (#${r.invoice_id})`);
        }
        clearForm(); await load();
      }catch(e){ toast('Hata: '+e.message) }
      finally{ btn.textContent=prev; btn.disabled=false }
    }

    async function edit(id){
      try{
        const inv = state.data.find(x=> Number(x.invoice_id)===Number(id));
        if(!inv){ toast('Bulunamadı'); return }
        el('invoice_id').value = inv.invoice_id;
        el('contact_id').value = inv.contact_id ?? '';
        el('issue_date').value = inv.issue_date ?? '';
        el('due_date').value = inv.due_date ?? '';
        el('status').value = inv.status ?? 'draft';
        el('note').value = inv.note ?? '';
        el('formTitle').textContent = `Fatura Düzenle • #${inv.invoice_id}`;
        const lines = typeof inv.lines === 'string' ? JSON.parse(inv.lines) : (inv.lines||[]);
        state.lines = []; el('lines').innerHTML='';
        if(lines.length){ lines.forEach(l=> newLine(l)) } else { newLine({}) }
        computeTotals();
        window.scrollTo({top:0,behavior:'smooth'});
      }catch(e){ toast('Yüklenemedi: '+e.message) }
    }

    function askDelete(id){
      state.pendingDelete = id; el('confirmText').textContent = `#${id} numaralı faturayı silmek üzeresin.`; el('confirmModal').classList.add('open');
    }

    async function doDelete(){
      const id = state.pendingDelete; if(!id) return; 
      try{ await api(`/invoices/${id}`, { method:'DELETE' }); toast(`#${id} silindi`); await load(); }
      catch(e){ toast('Silinemedi: '+e.message) }
      finally{ closeModal() }
    }

    function closeModal(){ el('confirmModal').classList.remove('open'); state.pendingDelete=null }

    async function pdf(id){
      try{
        const r = await api(`/invoices/${id}/pdf`);
        if(r.status==='success' && r.pdf_path){
          toast('PDF hazır: '+ r.pdf_path);
          // window.open(`${API_BASE}/static/${r.pdf_path.split('/').pop()}`, '_blank');
        } else { toast('PDF üretilemedi') }
      }catch(e){ toast('PDF hatası: '+e.message) }
    }

    async function adjust(id, delta){
      try{
        await api('/stock_movements', {
          method: 'POST',
          body: JSON.stringify({
            item_id: id,
            change: delta,
            reason: 'manual'
          })
        });
        await load(); // tekrar listeyi çek
      }catch(e){
        toast('Stok güncellenemedi: ' + (e.message || e));
      }
    }

    // Detay
    function viewDetail(id){
      const inv = state.data.find(x=> Number(x.invoice_id)===Number(id));
      if(!inv){ toast('Bulunamadı'); return }
      const lines = typeof inv.lines === 'string' ? JSON.parse(inv.lines) : (inv.lines||[]);
      if(!lines.length){
        el('detailBody').innerHTML = '<div class="empty">Kalem yok</div>';
      }else{
        const rows = lines.map(l=> `
          <tr>
            <td>${l.description||'-'}</td>
            <td>${fmt(Number(l.unit_price)||0)}</td>
            <td>${fmt(Number(l.quantity)||0)}</td>
            <td>${fmt(Number(l.tax_rate)||0)} %</td>
            <td>${fmt((Number(l.quantity)||0)*(Number(l.unit_price)||0))}</td>
          </tr>
        `).join('');
        el('detailBody').innerHTML = `
          <div style="overflow:auto;border-radius:12px">
            <table>
              <thead>
                <tr>
                  <th>Açıklama</th>
                  <th>Birim Fiyat</th>
                  <th>Adet</th>
                  <th>KDV</th>
                  <th>Ara Toplam</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>`;
      }
      el('detailModal').classList.add('open');
    }
    function closeDetail(){ el('detailModal').classList.remove('open') }

    // Settings
    document.getElementById('settingsBtn').addEventListener('click', ()=>{
      el('apiInput').value = localStorage.getItem('apiBase') || API_BASE;
      el('settingsModal').classList.add('open');
    });
    function closeSettings(){ el('settingsModal').classList.remove('open') }
    function saveSettings(){
      const v = el('apiInput').value.trim();
      if(!v){ toast('API adresi boş olamaz'); return }
      localStorage.setItem('apiBase', v);
      location.reload();
    }

    // Events
    el('q').addEventListener('input', e=>{ state.query=e.target.value; filter() });
    el('statusFilter').addEventListener('change', e=>{ state.status=e.target.value; filter() });
    el('refreshBtn').addEventListener('click', load);
    el('exportBtn').addEventListener('click', exportCSV);
    el('newBtn').addEventListener('click', ()=>{ clearForm(); newLine({}); window.scrollTo({top:0,behavior:'smooth'}) });
    el('addLineBtn').addEventListener('click', ()=> newLine({}));
    el('resetBtn').addEventListener('click', clearForm);
    el('clearBtn').addEventListener('click', clearForm);
    el('form').addEventListener('submit', submitForm);

    el('cancelConfirm').onclick = closeModal;
    el('okConfirm').onclick = doDelete;

    // CSV export (yaklaşık tutar dahil)
    function exportCSV(){
      const rows = [['ID','Müşteri','Tarih','Vade','Durum','Tutar']].concat(
        state.filtered.map(i=>[i.invoice_id,i.contact_id,i.issue_date,i.due_date,i.status,approxTotal(i)])
      );
      const csv = rows.map(r=> r.map(v=> '"'+String(v).replaceAll('"','""')+'"').join(',')).join('\n');
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='invoices.csv'; a.click(); URL.revokeObjectURL(url);
    }

    // Quick chips
    function buildChips(){
      const chips = [
        {k:'paid', t:'Ödendi'},
        {k:'sent', t:'Gönderildi'},
        {k:'draft', t:'Taslak'},
      ];
      const wrap = el('quickChips'); wrap.innerHTML='';
      chips.forEach(c=>{
        const b = document.createElement('div'); b.className='chip'; b.textContent=c.t; b.onclick=()=>{
          const f = el('statusFilter'); f.value=c.k; state.status=c.k; filter();
          wrap.querySelectorAll('.chip').forEach(x=>x.classList.remove('active')); b.classList.add('active');
        }; wrap.appendChild(b);
      })
    }

    // Kısayol: Ctrl+Enter = Kaydet
    document.addEventListener('keydown', (e)=>{
      if(e.ctrlKey && e.key === 'Enter'){ el('form').requestSubmit(); }
    });

    // Stok sayfasına geçiş
    el('itemsBtn').addEventListener('click', ()=>{
      window.location.href = 'items.html';
    });

    // Init
    buildChips(); clearForm(); newLine({}); load();
  </script>
</body>
</html>
